// Определение языка BSL для Prism.js
// @ts-ignore
import Prism from 'prismjs';
import 'prismjs/themes/prism.css';

// Убеждаемся, что Prism загружен
if (typeof window !== 'undefined' && !(window as any).Prism) {
  (window as any).Prism = Prism;
}

// Регистрируем язык BSL
(Prism.languages as any).bsl = {
  'comment': {
    pattern: /\/\/.*/,
    greedy: true
  },
  'string': {
    pattern: /"(?:[^"\\]|\\.)*"/,
    greedy: true,
    inside: {
      'continuation': {
        pattern: /\|/,
        alias: 'operator'
      }
    }
  },
  'preprocessor': {
    // Директивы препроцессора (#Если, #Область и т.д.) - красный цвет
    pattern: /#(?:Если|ИначеЕсли|Иначе|КонецЕсли|Область|КонецОбласти|Клиент|Сервер|ТолстыйКлиентОбычноеПриложение|ТолстыйКлиентУправляемоеПриложение|ВнешнееСоединение|МобильноеПриложениеКлиент|МобильноеПриложениеСервер|Или|И|Не)\b/i,
    alias: 'important'
  },
  'keyword': /\b(?:Процедура|Функция|КонецПроцедуры|КонецФункции|Если|Тогда|Иначе|ИначеЕсли|КонецЕсли|Пока|Цикл|КонецЦикла|Для|Каждого|Из|По|Попытка|Исключение|КонецПопытки|Возврат|Продолжить|Прервать|Перем|Перейти|ВызватьИсключение|Истина|Ложь|Неопределено|Null|И|Или|Не|Новый|СоздатьОбъект|ПолучитьОбъект|Выполнить|ВыполнитьСинхронно|Экспорт|ЗначениеЗаполнено|ТипЗнч|Вид|Тип)\b/i,
  'builtin': /\b(?:СтрДлина|СтрНайти|СтрЗаменить|СтрРазделить|Число|Строка|Формат|Лев|Прав|Сред|ВРег|НРег|СокрЛ|СокрП|СокрЛП|ТекущаяДата|ТекущаяДатаВремя|Год|Месяц|День|Окр|Цел|Мин|Макс|СлучайноеЧисло|Найти|НайтиПоПредставлению|ПолучитьИзВременногоХранилища|Сообщить|Предупреждение|Вопрос|ОжидатьПрерываниеПользователя)\b/i,
  'class-name': /\b(?:Строка|Число|Дата|Булево|Массив|Соответствие|Структура|ФиксированнаяСтруктура|ТаблицаЗначений|Запрос|РезультатЗапроса|ДвоичныеДанные|УникальныйИдентификатор)\b/i,
  'function': {
    // Имена процедур и функций
    pattern: /\b(?:Процедура|Функция)\s+([А-Яа-яЁёA-Za-z_][А-Яа-яЁёA-Za-z0-9_]*)/i,
    lookbehind: true,
    alias: 'function-name'
  },
  'number': /\b\d+(?:\.\d+)?\b/,
  'operator': /[=<>]+|[+\-*/]|\./,
  'punctuation': /[{}[\];(),:]/
};

// Директивы компиляции (&НаСервере, &НаКлиенте и т.д.) - синий цвет
(Prism.languages as any).bsl['directive'] = {
  pattern: /&[А-Яа-яЁёA-Za-z]+/,
  alias: 'keyword'
};

// Используем улучшенную реализацию подсветки BSL в стиле 1С
import { highlightBSL } from './bsl-highlighter-v2';

// Экспортируем функцию для совместимости
export { highlightBSL };

